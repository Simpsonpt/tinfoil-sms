/* 
Holder - 2.2 - client side image placeholders
(c) 2012-2013 Ivan Malopinsky / http://imsky.co

Provided under the MIT License.
Commercial use requires attribution.
*/
var Holder=Holder||{};
(function(f,D){function w(a){a=a.match(/^(\W)?(.*)/);a=document["getElement"+(a[1]?"#"==a[1]?"ById":"sByClassName":"sByTagName")](a[2]);var c=[];null!==a&&(a.length?c=a:0===a.length?c=a:c=[a]);return c}function r(a,c){var b={},d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);for(d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);return b}function s(a){var c=a.ctx,b=a.dimensions,d=a.template,e=a.ratio;a=a.holder;var g="literal"==a.textmode,k="exact"==a.textmode,h=b.width,f=b.height,f=parseInt(f,10),h=parseInt(h,
10),m=Math.max(f,h),h=Math.min(f,h),m=Math.min(0.75*h,1/12*m*0.75),m=Math.round(Math.max(d.size,m)),h=b.width*e,f=b.height*e,l=d.font?d.font:"sans-serif";p.width=h;p.height=f;c.textAlign="center";c.textBaseline="middle";c.fillStyle=d.background;c.fillRect(0,0,h,f);c.fillStyle=d.foreground;c.font="bold "+m+"px "+l;b=d.text?d.text:Math.floor(b.width)+"x"+Math.floor(b.height);g?(b=a.dimensions,b=b.width+"x"+b.height):k&&a.exact_dimensions&&(b=a.exact_dimensions,b=Math.floor(b.width)+"x"+Math.floor(b.height));
d=c.measureText(b).width;0.75<=d/h&&(m=Math.floor(h/d*m*0.75));c.font="bold "+m*e+"px "+l;c.fillText(b,h/2,f/2,h);return p.toDataURL("image/png")}function t(a,c,b,d){var e=b.dimensions,g=b.theme,f=b.text?decodeURIComponent(b.text):b.text,h=e.width+"x"+e.height,g=f?r(g,{text:f}):g,g=b.font?r(g,{font:b.font}):g;c.setAttribute("data-src",d);b.theme=g;c.holder_data=b;if("image"==a){c.setAttribute("alt",f?f:g.text?g.text+" ["+h+"]":h);if(n||!b.auto)c.style.width=e.width+"px",c.style.height=e.height+"px";
n?c.style.backgroundColor=g.background:(c.setAttribute("src",s({ctx:l,dimensions:e,template:g,ratio:u,holder:b})),b.textmode&&"exact"==b.textmode&&(x.push(c),q(c)))}else if("background"==a)n||(c.style.backgroundImage="url("+s({ctx:l,dimensions:e,template:g,ratio:u,holder:b})+")",c.style.backgroundSize=e.width+"px "+e.height+"px");else if("fluid"==a){c.setAttribute("alt",f?f:g.text?g.text+" ["+h+"]":h);"%"==e.height.slice(-1)?c.style.height=e.height:c.style.height=e.height+"px";"%"==e.width.slice(-1)?
c.style.width=e.width:c.style.width=e.width+"px";if("inline"==c.style.display||""===c.style.display||"none"==c.style.display)c.style.display="block";n?c.style.backgroundColor=g.background:(x.push(c),q(c))}}function E(a,c){var b={height:a.clientHeight,width:a.clientWidth};if(b.height||b.width)a.removeAttribute("data-holder-invisible");else{if(a.hasAttribute("data-holder-invisible"))throw Error("Holder: placeholder is not visible");a.setAttribute("data-holder-invisible",!0);setTimeout(function(){c.call(this,
a)},1);return null}return b}function q(a){a=null==a.nodeType?x:[a];for(var c in a)if(a.hasOwnProperty(c)){var b=a[c];if(b.holder_data){var d=b.holder_data,e=E(b,q);e&&(d.fluid&&b.setAttribute("src",s({ctx:l,dimensions:e,template:d.theme,ratio:u,holder:d})),d.textmode&&"exact"==d.textmode&&(d.exact_dimensions=e,b.setAttribute("src",s({ctx:l,dimensions:d.dimensions,template:d.theme,ratio:u,holder:d}))))}}}function y(a,c){var b={theme:r(v.themes.gray,{})},d=!1;sl=a.length;for(j=0;j<sl;j++){var e=a[j];
f.flags.dimensions.match(e)?(d=!0,b.dimensions=f.flags.dimensions.output(e)):f.flags.fluid.match(e)?(d=!0,b.dimensions=f.flags.fluid.output(e),b.fluid=!0):f.flags.textmode.match(e)?b.textmode=f.flags.textmode.output(e):f.flags.colors.match(e)?b.theme=f.flags.colors.output(e):c.themes[e]?c.themes.hasOwnProperty(e)&&(b.theme=r(c.themes[e],{})):f.flags.font.match(e)?b.font=f.flags.font.output(e):f.flags.auto.match(e)?b.auto=!0:f.flags.text.match(e)&&(b.text=f.flags.text.output(e))}return d?b:!1}var z=
!1,n=!1,p=document.createElement("canvas"),A=1,B=1,x=[];if(p.getContext)if(0>p.toDataURL("image/png").indexOf("data:image/png"))n=!0;else var l=p.getContext("2d");else n=!0;n||(A=window.devicePixelRatio||1,B=l.webkitBackingStorePixelRatio||l.mozBackingStorePixelRatio||l.msBackingStorePixelRatio||l.oBackingStorePixelRatio||l.backingStorePixelRatio||1);var u=A/B,v={domain:"holder.js",images:"img",bgnodes:".holderjs",themes:{gray:{background:"#eee",foreground:"#aaa",size:12},social:{background:"#3a5a97",
foreground:"#fff",size:12},industrial:{background:"#434A52",foreground:"#C2F200",size:12},sky:{background:"#0D8FDB",foreground:"#fff",size:12},vine:{background:"#39DBAC",foreground:"#1E292C",size:12},lava:{background:"#F8591A",foreground:"#1C2846",size:12}},stylesheet:""};f.flags={dimensions:{regex:/^(\d+)x(\d+)$/,output:function(a){a=this.regex.exec(a);return{width:+a[1],height:+a[2]}}},fluid:{regex:/^([0-9%]+)x([0-9%]+)$/,output:function(a){a=this.regex.exec(a);return{width:a[1],height:a[2]}}},
colors:{regex:/#([0-9a-f]{3,})\:#([0-9a-f]{3,})/i,output:function(a){a=this.regex.exec(a);return{size:v.themes.gray.size,foreground:"#"+a[2],background:"#"+a[1]}}},text:{regex:/text\:(.*)/,output:function(a){return this.regex.exec(a)[1]}},font:{regex:/font\:(.*)/,output:function(a){return this.regex.exec(a)[1]}},auto:{regex:/^auto$/},textmode:{regex:/textmode\:(.*)/,output:function(a){return this.regex.exec(a)[1]}}};document.getElementsByClassName||(document.getElementsByClassName=function(a){var c=
document,b,d=[];if(c.querySelectorAll)return c.querySelectorAll("."+a);if(c.evaluate)for(c=c.evaluate(".//*[contains(concat(' ', @class, ' '), ' "+a+" ')]",c,null,0,null);b=c.iterateNext();)d.push(b);else for(c=c.getElementsByTagName("*"),a=RegExp("(^|\\s)"+a+"(\\s|$)"),b=0;b<c.length;b++)a.test(c[b].className)&&d.push(c[b]);return d});window.getComputedStyle||(window.getComputedStyle=function(a){return this.el=a,this.getPropertyValue=function(c){var b=/(\-([a-z]){1})/g;return"float"==c&&(c="styleFloat"),
b.test(c)&&(c=c.replace(b,function(a,b,c){return c.toUpperCase()})),a.currentStyle[c]?a.currentStyle[c]:null},this});Object.prototype.hasOwnProperty||(Object.prototype.hasOwnProperty=function(a){var c=this.__proto__||this.constructor.prototype;return a in this&&(!(a in c)||c[a]!==this[a])});for(var C in f.flags)f.flags.hasOwnProperty(C)&&(f.flags[C].match=function(a){return a.match(this.regex)});f.add_theme=function(a,c){null!=a&&null!=c&&(v.themes[a]=c);return f};f.add_image=function(a,c){var b=
w(c);if(b.length)for(var d=0,e=b.length;d<e;d++){var g=document.createElement("img");g.setAttribute("data-src",a);b[d].appendChild(g)}return f};f.run=function(a){z=!0;a=r(v,a);var c=[],b=[],d=[];"string"==typeof a.images?b=w(a.images):window.NodeList&&a.images instanceof window.NodeList?b=a.images:window.Node&&a.images instanceof window.Node&&(b=[a.images]);"string"==typeof a.bgnodes?d=w(a.bgnodes):window.NodeList&&a.elements instanceof window.NodeList?d=a.bgnodes:window.Node&&a.bgnodes instanceof
window.Node&&(d=[a.bgnodes]);k=0;for(g=b.length;k<g;k++)c.push(b[k]);g=document.getElementById("holderjs-style");g||(g=document.createElement("style"),g.setAttribute("id","holderjs-style"),g.type="text/css",document.getElementsByTagName("head")[0].appendChild(g));a.nocss||(g.styleSheet?g.styleSheet.cssText+=a.stylesheet:g.appendChild(document.createTextNode(a.stylesheet)));for(var e=RegExp(a.domain+'/(.*?)"?\\)'),g=d.length,k=0;k<g;k++){var b=window.getComputedStyle(d[k],null).getPropertyValue("background-image"),
h=b.match(e),l=d[k].getAttribute("data-background-src");h?(h=y(h[1].split("/"),a))&&t("background",d[k],h,b):null!=l&&(h=y(l.substr(l.lastIndexOf(a.domain)+a.domain.length+1).split("/"),a))&&t("background",d[k],h,b)}g=c.length;for(k=0;k<g;k++){d=b=null;try{d=c[k].getAttribute("src"),attr_datasrc=c[k].getAttribute("data-src")}catch(m){}null==attr_datasrc&&d&&0<=d.indexOf(a.domain)?b=d:attr_datasrc&&0<=attr_datasrc.indexOf(a.domain)&&(b=attr_datasrc);b&&(h=y(b.substr(b.lastIndexOf(a.domain)+a.domain.length+
1).split("/"),a))&&(h.fluid?t("fluid",c[k],h,b):t("image",c[k],h,b))}return f};(function(a,c){var b=!1,d=!0,e=a.document,f=e.documentElement,k=e.addEventListener?"addEventListener":"attachEvent",h=e.addEventListener?"removeEventListener":"detachEvent",l=e.addEventListener?"":"on",m=function(d){"readystatechange"==d.type&&"complete"!=e.readyState||(("load"==d.type?a:e)[h](l+d.type,m,!1),b||!(b=!0)||c.call(a,null))},n=function(){try{f.doScroll("left")}catch(a){setTimeout(n,50);return}m("poll")};if("complete"==
e.readyState)c.call(a,"lazy");else{if(e.createEventObject&&f.doScroll){try{d=!a.frameElement}catch(p){}d&&n()}e[k](l+"DOMContentLoaded",m,!1);e[k](l+"readystatechange",m,!1);a[k](l+"load",m,!1)}})(D,function(){window.addEventListener?(window.addEventListener("resize",q,!1),window.addEventListener("orientationchange",q,!1)):window.attachEvent("onresize",q);z||f.run()});"function"===typeof define&&define.amd&&define([],function(){return f})})(Holder,window);
